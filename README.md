# PDF 文件分割工具

这是一个基于 Node.js 和 Express 框架开发的 Web 应用，用于将大型 PDF 文件按页分割成单独的 PDF 文件。

## 功能特点

- **PDF 文件上传**：支持拖放或浏览方式上传 PDF 文件
- **按页分割**：将 PDF 文件按原始页码分割成单独的文件
- **实时进度显示**：显示处理进度条和预估剩余时间
- **文件预览**：分割后的文件以网格形式展示
- **单文件下载**：可以单独下载每一页的 PDF 文件
- **批量下载**：支持将所有分割后的文件打包成 ZIP 下载
- **中文文件名支持**：自动处理中文文件名，确保文件名安全
- **英文文件名保留**：对于英文文件名，保留原始名称

## 技术栈

- **后端**：Node.js + Express
- **前端**：HTML + CSS + JavaScript
- **模板引擎**：EJS
- **PDF 处理**：pdf-lib
- **文件上传**：multer
- **文件压缩**：archiver

## 项目结构 


功能说明
上传页面：
支持拖放上传 PDF 文件
支持点击浏览选择 PDF 文件
只允许上传 PDF 格式文件
分割功能：
将上传的 PDF 按页分割成单独的 PDF 文件
保留原始页码信息
文件命名格式为：原文件名_第X页.pdf
结果页面：
以网格形式展示所有分割后的文件
显示每个文件的页码信息
提供下载按钮，点击即可下载对应的 PDF 文件
提供返回首页的链接
这个应用会将上传的 PDF 文件保存在 upload 目录中，分割后的文件保存在 download 目录中。每次上传新文件时，会清空 download 目录中的旧文件，以避免混淆。
帮我修改package.json,用nodemon启动项目

修改 package.json 使用 nodemon 启动项目
我将帮你修改 package.json 文件，使用 nodemon 来启动项目，这样在开发过程中修改代码后应用会自动重启。
安装依赖
你需要安装所有必要的依赖包，包括开发依赖 nodemon：
使用方法
安装完依赖后，你可以使用以下命令启动应用：
使用 node 启动: npm start
使用 nodemon 启动（开发模式）: npm run dev
使用 nodemon 启动后，当你修改代码时，应用会自动重启，无需手动重启服务器。
项目功能回顾
你的 PDF 分割应用已经完成，它包含：
上传页面：允许用户上传 PDF 文件
处理功能：将 PDF 按页分割成单独的文件
结果页面：展示分割后的文件并提供下载链接
所有文件都已经创建完成，包括：
app.js（主应用文件）
views/index.ejs（上传页面）
views/result.ejs（结果展示页面）
package.json（项目配置文件）
现在你可以使用 npm run dev 命令启动应用，并在浏览器中访问 http://localhost:3000 来使用这个 PDF 分割工具。
帮我在分割的时候，给出进度条，如果文件太大可以预估倒计时，不要程序超时

添加进度条和超时处理功能
我将帮你修改应用，添加进度条和超时处理功能，以便在处理大型PDF文件时提供更好的用户体验。
修改 app.js 文件
创建处理中页面 (processing.ejs)
修改 result.ejs 页面
不需要对 result.ejs 页面进行大的修改，它已经能够正确显示分割后的文件。
说明
这个实现添加了以下功能：
进度跟踪：
创建了一个处理中页面，显示进度条和处理状态
使用 AJAX 定期获取处理进度
显示已处理页数和百分比
预估剩余时间：
根据已处理页数和耗时计算每页平均处理时间
预估剩余处理时间并显示
后台处理：
将 PDF 分割过程放在后台进行，不阻塞响应
使用 setTimeout 避免长时间运行导致的超时问题
错误处理：
添加了错误处理机制，在处理失败时显示错误信息
资源清理：
处理完成后定时清理进度数据，避免内存泄漏
这样，即使处理大型 PDF 文件，用户也能看到进度并了解大致的等待时间，提高了用户体验。
在开始切割文件时，可以在download文件下创建一个文件夹，对应每个用户上传的PDF的一个任务，文件名可以是原文件名+时间戳，如果用户上传的是中文名的PDF，可以把他用对应的拼音名+时间戳。这个文件夹里存放了切割好的PDF。

修改 PDF 分割应用
我将帮你修改应用，为每个上传的 PDF 创建单独的文件夹，并处理中文文件名的情况。
添加拼音转换功能
首先，我们需要添加一个拼音转换的库来处理中文文件名：
修改文件上传和处理逻辑
20 个隐藏的行
52 个隐藏的行
修改结果页面路由
修改 result.ejs 页面，添加批量下载功能
添加批量下载功能
更新 result.ejs 的样式
安装所需的新依赖
你需要安装以下额外的 npm 包：
总结修改内容
文件夹组织：
为每个上传的 PDF 创建单独的文件夹
文件夹名称使用原文件名的拼音 + 时间戳
中文文件名处理：
使用 pinyin 库将中文文件名转换为拼音
保留原始文件名用于显示
批量下载功能：
添加了下载所有分割文件的 ZIP 压缩功能
临时创建 ZIP 文件，下载后自动删除
路由更新：
更新了下载路由以支持文件夹结构
添加了批量下载的新路由
这些修改使应用更加健壮，能够更好地处理中文文件名，并提供更好的用户体验。
出现了错误

修复 pinyin 模块使用错误
看起来我们在使用 pinyin 模块时遇到了问题。根据错误信息 TypeError: pinyin is not a function，这表明 pinyin 模块的导入或使用方式不正确。让我们修复这个问题：
如果上述修复不起作用，我们可以尝试另一种方法，完全避开 pinyin 模块的问题：
安装正确版本的 pinyin
如果你想继续使用 pinyin 模块，可能需要安装正确的版本。pinyin 模块的 API 可能在不同版本之间有变化。尝试以下命令：
然后修改代码：
50 个隐藏的行
使用替代方案
如果 pinyin 模块仍然有问题，我们可以使用一个简单的函数来处理文件名，确保它是安全的：
34 个隐藏的行
9 个隐藏的行
这些修改应该能解决 pinyin 模块的问题。选择最适合你的方案，确保应用能够正常处理中文文件名。
如果用户上传的是英文PDF保持原来的名字

修改 PDF 分割应用以保留英文文件名
我将修改应用，使其在处理英文文件名时保留原始名称，只对中文或特殊字符的文件名进行处理。
这个修改会检查文件名是否只包含英文字母、数字和一些安全字符（如下划线、连字符和点）。如果是，就保留原始文件名；如果包含中文或其他特殊字符，则进行安全处理。
完整的修改代码
这个修改很简单，只需要替换现有的 getSafeFilename 函数即可。这样，当用户上传英文命名的 PDF 文件时，应用会保留原始文件名；而对于中文或包含特殊字符的文件名，应用会进行安全处理，确保文件夹名称不会包含可能导致问题的字符。
现在，你的应用将能够：
保留纯英文文件名的原始形式
对中文或特殊字符的文件名进行安全处理
为每个上传的 PDF 创建单独的文件夹
提供分页预览和下载功能
支持批量下载所有分割后的文件
美化下页面，然后从页面index.ejs,processing.ejs,result.ejs这三个页面中，把css的代码分离出来，在views中创建CSS文件夹，把CSS文件放入CSS文件夹中。



改进了间距和排版，使页面更加美

创建 README 和 .gitignore 文件
README.md 文件
project-root/
├── app.js # 主应用文件
├── package.json # 项目配置文件
├── public/ # 静态资源目录
│ └── css/
│ └── style.css # 样式文件
├── upload/ # 上传文件存储目录
├── download/ # 分割后文件存储目录
└── views/ # 视图模板目录
├── index.ejs # 上传页面
├── processing.ejs # 处理进度页面
└── result.ejs # 结果展示页面
```
## 安装与运行

### 前提条件

- Node.js (v12.0.0 或更高版本)
- npm (v6.0.0 或更高版本)

### 安装步骤

1. 克隆或下载项目到本地
   ```
   git clone <仓库地址>
   ```

2. 进入项目目录
   ```
   cd pdf-splitter
   ```

3. 安装依赖
   ```
   npm install
   ```

4. 启动应用
   - 开发模式（使用 nodemon 自动重启）
     ```
     npm run dev
     ```
   - 生产模式
     ```
     npm start
     ```

5. 在浏览器中访问
   ```
   http://localhost:3000
   ```

## 使用说明

1. 在首页上传 PDF 文件（支持拖放或点击浏览）
2. 上传后，系统会显示处理进度页面，实时更新分割进度
3. 处理完成后，自动跳转到结果页面
4. 在结果页面可以：
   - 查看所有分割后的文件
   - 单独下载每一页
   - 下载所有文件的 ZIP 压缩包
   - 返回首页上传新文件

## 注意事项

- 上传的 PDF 文件会临时保存在 `upload` 目录中
- 分割后的文件会保存在 `download` 目录下的子文件夹中
- 每个上传任务会创建一个独立的文件夹，以避免文件混淆
- 处理大型 PDF 文件可能需要较长时间，请耐心等待

## 许可证
ISC